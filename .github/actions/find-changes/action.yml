name: Find Changes

description: Find changes within the first-level directories of the repo and output them for matrix strategy.

runs:
  using: "composite"
  steps:
    - uses: actions/checkout@v4
    - name: Get default branch name
      run: |
        DEFAULT_BRANCH=$(curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
          https://api.github.com/repos/${{ github.repository }} | jq -r .default_branch)
        echo "DEFAULT_BRANCH=$DEFAULT_BRANCH" >> $GITHUB_ENV
    - name: Find changes
      id: find_changes
      run: script.sh $DEFAULT_BRANCH

outputs:
  directories:
    description: 'JSON array of changed first-level directories'
    value: ${{ steps.find_changes.outputs.directories }}
