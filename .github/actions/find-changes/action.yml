name: Find changes

description: Find changes within the first-level directories of the repo and output them for matrix strategy.

inputs:
  github-token:
    description: 'GitHub token'
    required: true

runs:
  using: "composite"
  steps:
    - uses: actions/checkout@v4
    - name: Get default branch name
      shell: bash
      run: |
        DEFAULT_BRANCH=$(curl -s -H "Authorization: token ${{ inputs.github-token }}" \
          https://api.github.com/repos/${{ github.repository }} | jq -r .default_branch)
        echo "DEFAULT_BRANCH=$DEFAULT_BRANCH" >> $GITHUB_ENV
    - name: Find changes
      id: find_changes
      shell: bash
      run: $GITHUB_ACTION_PATH/script.sh $DEFAULT_BRANCH

outputs:
  directories:
    description: 'JSON array of changed first-level directories'
    value: ${{ steps.find_changes.outputs.directories }}
